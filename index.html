<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fundamentos de Estadística para Ciencia de Datos: Presentación Interactiva</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-box-and-violin-plot/build/Chart.BoxPlot.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            overflow: hidden; /* Evita el scroll del body principal */
        }
        .main-container {
            display: flex;
            height: 100vh;
        }
        .slide-container {
            flex-grow: 1;
            scroll-snap-type: y mandatory;
            overflow-y: scroll;
            height: 100vh;
        }
        .slide {
            scroll-snap-align: start;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border-bottom: 1px solid #e2e8f0;
            flex-direction: column;
        }
        .slide-content {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            width: 100%;
            max-width: 1280px; /* Ancho para pantallas de escritorio */
        }
        #speechPanel {
            width: 480px; /* Ancho aumentado para mejor legibilidad */
            flex-shrink: 0;
            height: 100vh;
            overflow-y: auto;
            background-color: rgba(241, 245, 249, 0.95);
            backdrop-filter: blur(5px);
            border-left: 1px solid #e2e8f0;
            padding: 1.5rem 2rem;
            transition: background-color 0.3s ease;
        }
        .speech-section h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e2e8f0;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .speech-section.active h2 {
            color: #4f46e5; /* indigo-600 */
            border-bottom-color: #4f46e5;
        }
        .formula {
            background-color: #eef2ff;
            color: #312e81;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1.25rem 0;
            font-family: 'Georgia', 'Times New Roman', Times, serif;
            font-size: 1.1rem;
            text-align: center;
            overflow-x: auto;
            white-space: nowrap;
            border: 1px solid #c7d2fe;
        }
        .formula .var { font-style: italic; }
        .formula .bar { text-decoration: overline; }
        .interactive-section { border: 1px solid #e2e8f0; padding: 1.5rem; border-radius: 0.75rem; margin-top: 1.5rem; background-color: #f9fafb; }
        .dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin: 1px; transition: all 0.3s ease; background-color: #93c5fd;}
        .sample-dot { background-color: #ef4444; transform: scale(1.5); box-shadow: 0 0 5px #ef4444; }
        .stratified-1 { background-color: #6ee7b7; }
        .stratified-2 { background-color: #fde047; }
        .stratified-3 { background-color: #fda4af; }
        .definition-box { background-color: #eef2ff; border-left: 4px solid #4f46e5; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.25rem; }
        .problem-context-box { background-color: #fefce8; border-left: 4px solid #eab308; padding: 1rem; margin-top: 1.5rem; border-radius: 0.25rem; }
        .findings-box { background-color: #f0fdf4; border-left: 4px solid #22c55e; padding: 1rem; margin-top: 1.5rem; border-radius: 0.25rem; }
        .data-table-container { max-height: 250px; overflow-y: auto; }
        .data-table th, .data-table td { padding: 8px 12px; border: 1px solid #e2e8f0; text-align: left; }
        .data-table th { background-color: #f1f5f9; }
        .data-table input { width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 4px; }
    </style>
</head>
<body>

<div class="main-container">

    <div class="slide-container">
        <!-- Diapositiva 1: Título -->
        <div id="slide1" class="slide bg-blue-50">
            <div class="text-center">
                <h1 class="text-5xl font-bold text-blue-800">Fundamentos de Estadística para Ciencia de Datos</h1>
                <p class="mt-4 text-2xl text-blue-600">Del Dato a la Decisión: Una Aventura Interactiva</p>
                <p class="mt-2 text-lg text-gray-700">¡Hola, futuros Científicos de Datos! Soy su Profesor Didáctico. Hoy veremos cómo la estadística es el motor que transforma datos crudos en decisiones inteligentes.</p>
                <p class="mt-8 text-gray-500">Desliza hacia abajo para comenzar</p>
                <svg class="w-8 h-8 mx-auto mt-4 text-blue-500 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
            </div>
        </div>

        <!-- Diapositiva 2: Población y Muestra -->
        <div id="slide2" class="slide">
            <div class="slide-content">
                <h2 class="text-3xl font-bold text-gray-800">Población y Muestra: Una pequeña muestra representativa nos permite entender el todo.</h2>
                <div class="problem-context-box">
                    <h3 class="font-bold text-yellow-800">Problema: Optimización de Campaña</h3>
                    <p>Una empresa de e-commerce con 1 millón de clientes (la **población**) quiere entender el valor de compra promedio para lanzar una campaña. Analizar a todos es inviable.</p>
                </div>
                <div class="interactive-section">
                    <h3 class="text-xl font-semibold text-gray-700">Simulador: Inferencia y Teorema del Límite Central</h3>
                    <div class="flex flex-wrap gap-4 items-center mt-4">
                        <button id="generatePopulationBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">1. Simular Población</button>
                        <button id="drawSampleBtn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition" disabled>2. Extraer Muestra (y graficar su media)</button>
                    </div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                        <!-- Columna 1: Visualización de Población/Muestra -->
                        <div>
                            <div id="populationViz" class="mt-4 p-4 bg-gray-100 rounded-lg" style="display:none;">
                                <div class="flex flex-wrap justify-center" id="populationDotsContainer"></div>
                                <p id="populationMean" class="text-lg text-center font-semibold mt-2"></p>
                            </div>
                             <div id="sampleViz" class="mt-4 p-4 bg-red-50 rounded-lg" style="display:none;">
                                <p id="sampleMean" class="text-lg text-center font-semibold"></p>
                            </div>
                        </div>
                        <!-- Columna 2: Histograma de Medias Muestrales -->
                        <div id="meansHistogramContainer" style="display:none;">
                            <h4 class="font-semibold text-center">Distribución de Medias Muestrales</h4>
                            <p class="text-sm text-center text-gray-600">Cada clic agrega la media de una nueva muestra.</p>
                            <div class="relative mt-2" style="height: 250px;">
                                <canvas id="meansHistogramCanvas"></canvas>
                            </div>
                            <button id="resetMeansBtn" class="mt-2 bg-gray-500 text-white font-bold py-1 px-3 text-sm rounded-lg hover:bg-gray-600 transition w-full">Reiniciar Histograma</button>
                        </div>
                    </div>
                </div>
                <div id="decision-box-2" class="findings-box" style="display:none;">
                    <h3 class="font-bold text-green-800">Hallazgo y Decisión</h3><p id="samplingConclusion"></p>
                </div>
            </div>
        </div>

        <!-- Diapositiva 3: Tipos de Variables -->
        <div id="slide3" class="slide">
            <div class="slide-content">
                <h2 class="text-3xl font-bold text-gray-800">Tipos de Variables: La brújula que guía tu análisis.</h2>
                 <div class="definition-box mt-4">
                    <ul class="list-disc list-inside space-y-4">
                        <li><strong>Cualitativas (Categóricas):</strong> Describen cualidades.
                            <ul class="list-disc list-inside ml-6 mt-1 text-gray-700">
                                <li><strong>Nominales:</strong> Sin orden (País, Género).</li>
                                <li><strong>Ordinales:</strong> Con orden (Nivel de Satisfacción: 'Malo' a 'Excelente').</li>
                            </ul>
                        </li>
                         <li><strong>Cuantitativas (Numéricas):</strong> Miden cantidades.
                            <ul class="list-disc list-inside ml-6 mt-1 text-gray-700">
                                <li><strong>Discretas (CONTAMOS):</strong> Nº de compras, nº de clics.</li>
                                <li><strong>Continuas (MEDIMOS):</strong> Gasto del cliente, tiempo en la página.</li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="interactive-section">
                    <h3 class="text-xl font-semibold text-gray-700">Actividad: Clasificador de Variables</h3>
                    <div class="p-4 bg-white rounded-lg border text-center mt-4">
                        <p class="text-2xl font-bold text-indigo-600" id="variableToClassify"></p>
                    </div>
                    <div id="variableOptions" class="flex flex-wrap gap-4 mt-4 justify-center"></div>
                    <p id="variableFeedback" class="mt-4 text-center font-bold h-6"></p>
                </div>
            </div>
        </div>
        
        <!-- Diapositiva 4: Visualización Cualitativa -->
        <div id="slide4" class="slide">
            <div class="slide-content">
                <h2 class="text-3xl font-bold text-gray-800">Visualización Cualitativa: Los gráficos de barras revelan la causa principal.</h2>
                <div class="problem-context-box">
                    <h3 class="font-bold text-yellow-800">Problema: Análisis de Churn (Abandono)</h3>
                    <p>Una app de streaming quiere saber por qué los usuarios cancelan su suscripción. Se encuesta a una muestra de ex-usuarios para identificar el motivo principal y tomar acciones correctivas.</p>
                </div>
                <div class="interactive-section">
                    <h3 class="text-xl font-semibold text-gray-700">Actividad: Descubriendo el Motivo Principal</h3>
                    <div class="flex flex-wrap gap-4 items-center mt-4">
                        <button onclick="loadSampleData('churn')" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition">Cargar Datos de Encuesta</button>
                        <button id="toggle-churn-data" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition" style="display: none;">Ver/Ocultar Tabla de Datos</button>
                    </div>
                    <div id="chartsContainer" class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-8 items-center" style="display:none;">
                        <div><h4 class="font-semibold text-center mb-2">Gráfico de Barras</h4><div class="relative" style="height: 300px;"><canvas id="barChartCanvas"></canvas></div></div>
                        <div><h4 class="font-semibold text-center mb-2">Gráfico de Pastel</h4><div class="relative" style="height: 300px;"><canvas id="pieChartCanvas"></canvas></div></div>
                    </div>
                    <div id="churnDataTableContainer" class="mt-4" style="display:none;">
                        <div class="data-table-container"><table class="w-full data-table"><thead><tr><th>Motivo</th><th>Frecuencia</th></tr></thead><tbody id="churnDataTableBody"></tbody></table></div>
                        <button onclick="recalculateChart('churn')" class="mt-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Recalcular Gráfico</button>
                    </div>
                </div>
                <div id="findings-box-4" class="findings-box" style="display:none;">
                    <h3 class="font-bold text-green-800">Hallazgo y Decisión</h3>
                    <p>El gráfico de barras muestra inequívocamente que "Precio elevado" es la razón más frecuente. La decisión de negocio es priorizar una revisión de la estrategia de precios.</p>
                </div>
            </div>
        </div>
        
        <!-- Diapositiva 5: Histograma -->
        <div id="slide5" class="slide">
            <div class="slide-content">
                <h2 class="text-3xl font-bold text-gray-800">Histograma: La radiografía de tus datos cuantitativos.</h2>
                <div class="problem-context-box">
                    <h3 class="font-bold text-yellow-800">Problema: Evaluación de Examen</h3>
                    <p>Un educador online necesita analizar las calificaciones de un examen final para determinar si la dificultad fue adecuada o si necesita ajustar el curso o la evaluación para futuros estudiantes.</p>
                </div>
                <div class="interactive-section">
                    <h3 class="text-xl font-semibold text-gray-700">Actividad: Analizando la Distribución de Calificaciones</h3>
                     <div class="flex flex-wrap gap-4 items-center mt-4">
                         <button onclick="loadSampleData('exam_normal')" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">Simular Datos Normales</button>
                         <button onclick="loadSampleData('exam_skewed')" class="bg-orange-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-700 transition">Simular Datos Sesgados</button>
                         <button id="toggle-histogram-data" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition" style="display: none;">Ver/Ocultar Tabla de Datos</button>
                    </div>
                    <div id="histogramControls" class="mt-4 flex items-center gap-4" style="display: none;">
                        <label for="binsSlider" class="font-semibold">Número de Barras:</label>
                        <input type="range" id="binsSlider" min="5" max="50" value="15" class="w-full">
                        <span id="binsValue" class="font-semibold text-indigo-600 w-12 text-center">15</span>
                    </div>
                    <div id="histogramContainer" class="mt-4" style="display:none;">
                        <h4 class="font-semibold text-center mb-2">Histograma de Calificaciones</h4>
                        <div class="relative" style="height: 300px; padding-bottom: 20px;"><canvas id="histogramCanvas"></canvas></div>
                    </div>
                    <div id="histogramDataTableContainer" class="mt-4" style="display:none;">
                        <div class="data-table-container"><table class="w-full data-table"><thead><tr><th>Índice</th><th>Calificación</th></tr></thead><tbody id="histogramDataTableBody"></tbody></table></div>
                        <button onclick="recalculateChart('histogram')" class="mt-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Recalcular Gráfico</button>
                    </div>
                </div>
                <div id="findings-box-5" class="findings-box" style="display:none;">
                    <h3 class="font-bold text-green-800">Hallazgo y Decisión</h3>
                    <p id="histogram-explanation"></p>
                </div>
            </div>
        </div>
        
        <!-- Diapositiva 6: Tendencia Central -->
        <div id="slide6" class="slide">
            <div class="slide-content">
                <h2 class="text-3xl font-bold text-gray-800">Tendencia Central: La mediana es más fiable que la media ante outliers.</h2>
                <div class="problem-context-box">
                    <h3 class="font-bold text-yellow-800">Problema: Eficiencia del Soporte Técnico</h3>
                    <p>Un manager quiere medir el tiempo de resolución de tickets. La mayoría se resuelven rápido, pero unos pocos casos muy complejos (outliers) tardan días y podrían distorsionar la percepción del rendimiento.</p>
                </div>
                <div class="interactive-section">
                    <h3 class="text-xl font-semibold text-gray-700">Actividad: Media vs. Mediana en Acción</h3>
                    <div class="flex flex-wrap gap-4 items-center mt-4">
                        <button onclick="loadSampleData('tickets')" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition">Cargar Tiempos de Tickets</button>
                        <button id="toggle-tickets-data" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition" style="display: none;">Ver/Ocultar Tabla de Datos</button>
                    </div>
                    <div id="tendencyResults" class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-center" style="display:none;">
                        <div class="p-4 bg-gray-50 rounded-lg"><p class="text-sm text-gray-500">Media (Promedio)</p><p id="meanResult" class="text-2xl font-bold">-</p></div>
                        <div class="p-4 bg-gray-50 rounded-lg"><p class="text-sm text-gray-500">Mediana (Típico)</p><p id="medianResult" class="text-2xl font-bold">-</p></div>
                        <div class="p-4 bg-gray-50 rounded-lg"><p class="text-sm text-gray-500">Moda (Frecuente)</p><p id="modeResult" class="text-2xl font-bold">-</p></div>
                    </div>
                    <div id="ticketsDataTableContainer" class="mt-4" style="display:none;">
                        <div class="data-table-container"><table class="w-full data-table"><thead><tr><th>Índice</th><th>Tiempo (min)</th></tr></thead><tbody id="ticketsDataTableBody"></tbody></table></div>
                        <button onclick="recalculateChart('tickets')" class="mt-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Recalcular Métricas</button>
                    </div>
                </div>
                <div id="findings-box-6" class="findings-box" style="display:none;">
                    <h3 class="font-bold text-green-800">Hallazgo y Decisión</h3>
                    <p>La <strong>Media</strong> es alta y engañosa por el outlier. La <strong>Mediana</strong> es mucho más baja y representa el tiempo de resolución *típico*. La decisión es usar la <strong>mediana</strong> como el KPI principal para medir la eficiencia del equipo.</p>
                </div>
            </div>
        </div>
        
        <!-- Diapositiva 7: Dispersión -->
        <div id="slide7" class="slide">
            <div class="slide-content">
                 <h2 class="text-3xl font-bold text-gray-800">Dispersión: El diagrama de caja revela la consistencia y el riesgo.</h2>
                <div class="problem-context-box">
                    <h3 class="font-bold text-yellow-800">Problema: Selección de Proveedor Logístico</h3>
                    <p>Un gerente de logística debe elegir entre dos proveedores basándose no solo en la velocidad promedio de entrega, sino, más importante aún, en la fiabilidad y consistencia del servicio.</p>
                </div>
                <div class="interactive-section">
                    <h3 class="text-xl font-semibold text-gray-700">Actividad: Evaluando la Consistencia</h3>
                     <div class="flex flex-wrap gap-4 items-center mt-4">
                        <button onclick="loadSampleData('provider_a')" class="bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-emerald-700 transition">Analizar Proveedor A</button>
                        <button onclick="loadSampleData('provider_b')" class="bg-orange-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-700 transition">Analizar Proveedor B</button>
                        <button id="toggle-provider-data" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition" style="display: none;">Ver/Ocultar Tabla de Datos</button>
                    </div>
                    <div id="dispersionResults" style="display:none">
                        <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-center" id="descriptiveResults"></div>
                        <div class="mt-4 relative" style="height: 200px;"><canvas id="boxPlotCanvas"></canvas></div>
                    </div>
                     <div id="providerDataTableContainer" class="mt-4" style="display:none;">
                        <div class="data-table-container"><table class="w-full data-table"><thead><tr><th>Índice</th><th>Tiempo de Entrega</th></tr></thead><tbody id="providerDataTableBody"></tbody></table></div>
                        <button onclick="recalculateChart('provider')" class="mt-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Recalcular Gráfico</button>
                    </div>
                </div>
                 <div id="findings-box-7" class="findings-box" style="display:none;">
                    <h3 class="font-bold text-green-800">Hallazgo y Decisión</h3>
                    <p id="descriptive-explanation"></p>
                </div>
            </div>
        </div>

        <!-- Diapositiva 8: Muestreo -->
        <div id="slide8" class="slide">
            <div class="slide-content">
                <h2 class="text-3xl font-bold text-gray-800">Muestreo: La selección al azar es la clave para evitar sesgos.</h2>
                <div class="definition-box mt-4">
                     <ul class="list-disc list-inside mt-2">
                        <li><strong>Aleatorio Simple:</strong> Sorteo puro. Cada elemento tiene la misma probabilidad.</li>
                        <li><strong>Estratificado:</strong> Asegura la representación de subgrupos importantes (ej. por regiones, edad).</li>
                    </ul>
                </div>
                <div class="interactive-section">
                    <h3 class="text-xl font-semibold text-gray-700">Actividad: Tipos de Muestreo en Acción</h3>
                    <div id="samplingMethodsPopulation" class="p-4 bg-white rounded grid grid-cols-10 gap-2 border mt-4"></div>
                    <div class="flex flex-wrap gap-4 mt-4 justify-center">
                        <button onclick="runSampling('simple')" class="bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700 transition">Aleatorio Simple</button>
                        <button onclick="runSampling('stratified')" class="bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700 transition">Estratificado</button>
                        <button onclick="runSampling('reset')" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition">Reiniciar</button>
                    </div>
                     <p id="samplingMethodDesc" class="mt-4 text-center text-gray-600 font-medium h-10"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel Lateral con el Speech -->
    <div id="speechPanel">
        <div class="speech-section" data-slide-id="slide1">
            <h2 class="active">Bienvenida: Transforma Datos en Decisiones</h2>
            <p class="text-gray-700 text-sm leading-relaxed">¡Bienvenidos a bordo, futuros científicos de datos! En esta era digital, los datos son el nuevo petróleo, y ustedes serán los ingenieros que los refinarán para extraer su máximo valor. La ciencia de datos es mucho más que números y algoritmos; es el arte y la ciencia de transformar datos crudos en inteligencia accionable que impulse decisiones de negocio inteligentes.<br><br>Nuestro viaje de hoy los equipará con las herramientas fundamentales de la estadística descriptiva y el muestreo, pilares esenciales para cualquier análisis de datos riguroso.</p>
        </div>
        <div class="speech-section mt-6" data-slide-id="slide2">
            <h2>Población y Muestra</h2>
            <p class="text-gray-700 text-sm leading-relaxed">Comencemos con dos conceptos que son la piedra angular de cualquier estudio estadístico: la <strong>población</strong> y la <strong>muestra</strong>. Imaginen un vasto océano: ese es nuestra población. Es el conjunto total de individuos que deseamos comprender. Sin embargo, estudiarlo por completo sería inviable.<br><br>Aquí es donde entra en juego la muestra: un <strong>subconjunto representativo</strong> de esa población. Su propósito es que, al analizarla, podamos extraer conclusiones válidas que sean <strong>extrapolables</strong> a toda la población. La clave aquí es la <strong>representatividad</strong>. Este proceso se llama <strong>inferencia estadística</strong>.<br><br>En el mundo del Big Data, el muestreo es una técnica eficiente para tomar decisiones informadas sin tener que procesar la totalidad de la información.</p>
        </div>
        <div class="speech-section mt-6" data-slide-id="slide3">
            <h2>Tipos de Variables</h2>
            <p class="text-gray-700 text-sm leading-relaxed">Es crucial entender qué tipo de datos tenemos, porque su naturaleza dictará las herramientas de análisis a usar. Se clasifican en:</p>
            <ol class="list-decimal list-inside mt-2 space-y-2 text-sm">
                <li><strong>Cualitativas:</strong> Expresan cualidades.
                    <ul class="list-disc list-inside ml-4">
                        <li><strong>Nominales:</strong> Sin orden (ej. estado civil, color de ojos).</li>
                        <li><strong>Ordinales:</strong> Con orden jerárquico (ej. nivel de satisfacción).</li>
                    </ul>
                </li>
                <li><strong>Cuantitativas:</strong> Se expresan con números.
                    <ul class="list-disc list-inside ml-4">
                        <li><strong>Discretas:</strong> Valores contables (ej. nº de hijos).</li>
                        <li><strong>Continuas:</strong> Cualquier valor en un rango (ej. estatura, peso).</li>
                    </ul>
                </li>
            </ol>
             <p class="text-gray-700 text-sm leading-relaxed mt-2">¡La elección del tipo de variable es el primer paso para elegir la prueba estadística adecuada!</p>
        </div>
        <div class="speech-section mt-6" data-slide-id="slide4">
             <h2>Visualización Cualitativa</h2>
             <p class="text-gray-700 text-sm leading-relaxed">Para variables cualitativas, el <strong>diagrama de barras</strong> es una herramienta fundamental. Compara visualmente frecuencias entre categorías. Aunque populares, los <strong>gráficos de pastel</strong> se vuelven confusos con muchas categorías.<br><br>Un caso especial y muy útil es el <strong>diagrama de Pareto</strong>. Este ordena las barras de mayor a menor frecuencia, e incluye una línea de frecuencia acumulada. Permite aplicar la regla 80/20 para identificar los "pocos problemas vitales" que causan la mayoría de las incidencias, siendo una herramienta clave para la toma de decisiones y la gestión de calidad.</p>
        </div>
        <div class="speech-section mt-6" data-slide-id="slide5">
            <h2>Histograma</h2>
            <p class="text-gray-700 text-sm leading-relaxed">Para variables cuantitativas continuas, el <strong>histograma</strong> es la herramienta visual más poderosa. A diferencia de un gráfico de barras, agrupa los datos en rangos (o "bins") y muestra la frecuencia de valores dentro de cada rango.<br><br>Un histograma nos permite ver de un vistazo:<br>
             <ul class="list-disc list-inside ml-4 text-sm">
                <li>La <strong>forma</strong> de la distribución (simétrica, sesgada).</li>
                <li>El <strong>centro</strong> y la <strong>dispersión</strong> de los datos.</li>
                <li>La presencia de posibles <strong>outliers</strong>.</li>
            </ul>
            <br>La forma de la distribución es clave. Por ejemplo, en las calificaciones de un examen, una distribución normal (en forma de campana) sugiere una prueba bien diseñada, mientras que una distribución sesgada puede indicar que fue demasiado fácil o difícil.</p>
        </div>
        <div class="speech-section mt-6" data-slide-id="slide6">
            <h2>Medidas de Tendencia Central</h2>
            <p class="text-gray-700 text-sm leading-relaxed">Necesitamos números que resuman el "centro" de los datos.</p>
            <ol class="list-decimal list-inside mt-2 space-y-2 text-sm">
                <li><strong>Media Aritmética ($\bar{x}$):</strong> El promedio. Es fácil de calcular pero <strong>muy sensible a valores extremos (outliers)</strong>.
                    <div class="formula"><span class="var bar">x</span> = Σ <span class="var">x</span><sub>i</sub> / <span class="var">n</span></div>
                </li>
                <li><strong>Mediana (Me):</strong> El valor central de los datos ordenados. Es <strong>robusta a outliers</strong>, siendo más representativa en distribuciones asimétricas (como salarios).</li>
                <li><strong>Moda (Mo):</strong> El valor que más se repite.</li>
            </ol>
             <p class="text-gray-700 text-sm leading-relaxed mt-2">En una distribución simétrica, las tres son casi idénticas. En una asimétrica, la media se desplaza hacia la cola larga.</p>
        </div>
        <div class="speech-section mt-6" data-slide-id="slide7">
            <h2>Medidas de Dispersión</h2>
            <p class="text-gray-700 text-sm leading-relaxed">Necesitamos saber qué tan dispersos son nuestros datos. La <strong>Desviación Estándar ($S$)</strong> es fundamental, pues mide la dispersión promedio en las mismas unidades que los datos.</p>
            <div class="formula"><span class="var">S</span> = √ [ Σ (<span class="var">x</span><sub>i</sub> - <span class="var bar">x</span>)<sup>2</sup> / (<span class="var">n</span>-1) ]</div>
            <p class="text-gray-700 text-sm leading-relaxed mt-2">Una herramienta visual clave es el <strong>Diagrama de Caja (Box Plot)</strong>. La "caja" representa el 50% central de los datos (Rango Intercuartílico, IQR), una medida de dispersión robusta que nos muestra la <strong>consistencia</strong>. Los puntos fuera de los "bigotes" son outliers, que señalan <strong>riesgo</strong> o anomalías.</p>
             <div class="formula">IQR = <span class="var">Q</span><sub>3</sub> - <span class="var">Q</span><sub>1</sub></div>
        </div>
        <div class="speech-section mt-6" data-slide-id="slide8">
            <h2>Técnicas de Muestreo</h2>
            <p class="text-gray-700 text-sm leading-relaxed">¿Cómo seleccionamos una muestra sin sesgos? Usando <strong>muestreo probabilístico</strong>, donde cada elemento tiene una probabilidad conocida de ser seleccionado.</p>
             <ol class="list-decimal list-inside mt-2 space-y-2 text-sm">
                <li><strong>Aleatorio Simple (MAS):</strong> Como un sorteo. Cada elemento tiene la misma probabilidad. Requiere un listado completo de la población.</li>
                <li><strong>Estratificado:</strong> Se divide la población en subgrupos homogéneos (estratos) y se muestrea de cada uno. Asegura la representatividad de grupos minoritarios.</li>
                 <li><strong>Por Conglomerados (Clusters):</strong> Se seleccionan grupos naturales completos (ej. ciudades) al azar. Eficiente para poblaciones dispersas.</li>
            </ol>
            <p class="text-gray-700 text-sm leading-relaxed mt-2">La <strong>selección al azar</strong> es el principio fundamental para evitar el sesgo de muestreo y obtener conclusiones válidas y creíbles.</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        let globalData = {}; 
        let barChart, pieChart, histogramChart, boxPlotChart, meansHistogramChart;
        let truePopulationMean = 0;
        let sampleMeansDistribution = [];

        // --- Generadores de Datos ---
        function generateNormalData(n = 500, mean = 75, stdDev = 10) {
            let data = [];
            for (let i = 0; i < n; i++) {
                let u = 0, v = 0;
                while(u === 0) u = Math.random(); 
                while(v === 0) v = Math.random();
                let num = Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
                num = num * stdDev + mean;
                data.push(parseFloat(Math.max(0, Math.min(100, num)).toFixed(1)));
            }
            return data;
        }
        function generateSkewedData(n = 500) {
            let data = [];
            for (let i = 0; i < n; i++) {
                const skewed = 100 - Math.pow(Math.random(), 2.0) * 100;
                data.push(parseFloat(Math.max(0, Math.min(100, skewed)).toFixed(1)));
            }
            return data;
        }
        
        // --- Registro Global de Plugins de Chart.js ---
        const rugPlotPlugin = {
            id: 'rugPlot',
            afterDraw: chart => {
                if (chart.canvas.id !== 'histogramCanvas') return;
                const ctx = chart.ctx;
                const chartArea = chart.chartArea;
                const dataPoints = globalData.histogram || [];
                if (!dataPoints.length || !chartArea) return;

                const xScale = chart.scales['x-axis-0'];
                
                ctx.save();
                ctx.strokeStyle = 'rgba(79, 70, 229, 0.8)';
                ctx.lineWidth = 1.5;
                
                dataPoints.forEach(value => {
                    const x = xScale.getPixelForValue(value);
                    if (x >= chartArea.left && x <= chartArea.right) {
                        ctx.beginPath();
                        ctx.moveTo(x, chartArea.bottom);
                        ctx.lineTo(x, chartArea.bottom + 8);
                        ctx.stroke();
                    }
                });
                ctx.restore();
            }
        };
        Chart.plugins.register(rugPlotPlugin);
        

        // --- Lógica de Toggles para Tablas ---
        function setupToggle(buttonId, chartContainerId, tableContainerId) {
            const button = document.getElementById(buttonId);
            if(button) {
                button.style.display = 'inline-block';
                button.onclick = () => {
                    const chartContainer = document.getElementById(chartContainerId);
                    const tableContainer = document.getElementById(tableContainerId);
                    const isChartVisible = chartContainer.style.display !== 'none';
                    chartContainer.style.display = isChartVisible ? 'none' : 'grid';
                    tableContainer.style.display = isChartVisible ? 'block' : 'none';
                };
            }
        }
        
        // --- Recalcular Gráficos desde Tablas Editadas ---
        window.recalculateChart = function(type) {
             if (type === 'churn') {
                const rows = document.getElementById('churnDataTableBody').rows;
                const data = { labels: [], values: [] };
                for(const row of rows) {
                    data.labels.push(row.cells[0].innerText);
                    data.values.push(parseInt(row.cells[1].querySelector('input').value, 10) || 0);
                }
                generateQualitativeCharts(data);
            } else if (type === 'histogram') {
                const data = Array.from(document.getElementById('histogramDataTableBody').rows).map(row => parseFloat(row.cells[1].querySelector('input').value) || 0);
                const bins = parseInt(document.getElementById('binsSlider').value, 10);
                generateHistogram(data, bins);
            } else if (type === 'tickets') {
                 const data = Array.from(document.getElementById('ticketsDataTableBody').rows).map(row => parseFloat(row.cells[1].querySelector('input').value) || 0);
                 calculateCentralTendency(data);
            } else if (type === 'provider') {
                const data = Array.from(document.getElementById('providerDataTableBody').rows).map(row => parseFloat(row.cells[1].querySelector('input').value) || 0);
                generateDispersionAnalysis(data);
            }
        }

        // --- Funciones de Generación de Gráficos ---
        function generateQualitativeCharts(data) {
            const chartData = (typeof data === 'string') ? 
                (() => {
                    const counts = data.split(',').map(i => i.trim()).reduce((acc, val) => ({ ...acc, [val]: (acc[val] || 0) + 1 }), {});
                    return { labels: Object.keys(counts), values: Object.values(counts) };
                })() : data;
            
            globalData.churn = chartData;
            populateChurnTable(chartData.labels, chartData.values);
            const dataset = { data: chartData.values, backgroundColor: ['rgba(239, 68, 68, 0.6)', 'rgba(59, 130, 246, 0.6)', 'rgba(234, 179, 8, 0.6)', 'rgba(16, 185, 129, 0.6)'] };
            if (barChart) barChart.destroy();
            barChart = new Chart('barChartCanvas', { type: 'bar', data: { labels: chartData.labels, datasets: [dataset] }, options: { responsive: true, maintainAspectRatio: false, legend: { display: false }, scales: { yAxes: [{ ticks: { beginAtZero: true, stepSize: 2 } }], xAxes: [{ ticks: { autoSkip: false, maxRotation: 45, minRotation: 45 } }] } } });
            if (pieChart) pieChart.destroy();
            pieChart = new Chart('pieChartCanvas', { type: 'pie', data: { labels: chartData.labels, datasets: [dataset] }, options: { responsive: true, maintainAspectRatio: false, legend: { position: 'right' } } });
        }
        function populateChurnTable(labels, values) {
            const tbody = document.getElementById('churnDataTableBody');
            tbody.innerHTML = '';
            labels.forEach((label, i) => { tbody.innerHTML += `<tr><td>${label}</td><td><input type="number" value="${values[i]}" class="data-input"></td></tr>`; });
        }
        
        function generateHistogram(data, numBins = 15) {
            globalData.histogram = data;
            populateNumericTable('histogramDataTableBody', data);
            
            const dataMin = Math.min(...data);
            const dataMax = Math.max(...data);
            const binWidth = (dataMax - dataMin) / numBins;

            let bins = Array(numBins).fill(0);
            let labels = Array.from({length: numBins}, (_, i) => {
                const start = dataMin + i * binWidth;
                const end = start + binWidth;
                return `${start.toFixed(0)}-${end.toFixed(0)}`;
            });

            data.forEach(value => {
                if (value === dataMax) {
                    bins[numBins - 1]++;
                } else {
                    const binIndex = Math.floor((value - dataMin) / binWidth);
                    if (binIndex >= 0 && binIndex < numBins) {
                        bins[binIndex]++;
                    }
                }
            });

            if (histogramChart) histogramChart.destroy();
            histogramChart = new Chart('histogramCanvas', { 
                type: 'bar', 
                data: { 
                    labels, 
                    datasets: [{ 
                        data: bins, 
                        backgroundColor: 'rgba(79, 70, 229, 0.6)',
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    legend: { display: false }, 
                    scales: { 
                        yAxes: [{ ticks: { beginAtZero: true }, scaleLabel: { display: true, labelString: 'Nº de Estudiantes'} }], 
                        xAxes: [{ 
                            barPercentage: 1.0, 
                            categoryPercentage: 1.0,
                            gridLines: { display: false }, 
                            scaleLabel: { display: true, labelString: 'Rango de Calificaciones' },
                            ticks: { maxTicksLimit: 15, autoSkip: true }
                        }] 
                    } 
                }
            });
        }
        
        function calculateCentralTendency(data) {
            const nums = (typeof data === 'string') ? data.split(',').map(n => parseFloat(n.trim())) : data;
            globalData.tickets = nums;
            populateNumericTable('ticketsDataTableBody', nums);
            const mean = nums.reduce((a, b) => a + b, 0) / nums.length;
            const sorted = [...nums].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            const median = sorted.length % 2 !== 0 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
            const counts = nums.reduce((acc, val) => ({ ...acc, [val]: (acc[val] || 0) + 1 }), {});
            let maxFreq = 0; let modes = [];
            for (const key in counts) { if (counts[key] > maxFreq) { modes = [key]; maxFreq = counts[key]; } else if (counts[key] === maxFreq) modes.push(key); }
            document.getElementById('meanResult').textContent = mean.toFixed(1) + " min";
            document.getElementById('medianResult').textContent = median.toFixed(1) + " min";
            document.getElementById('modeResult').textContent = maxFreq > 1 ? modes.join(', ') : 'N/A';
        }

        function generateDispersionAnalysis(data) {
            const nums = (typeof data === 'string') ? data.split(',').map(n => parseFloat(n.trim())) : data;
            globalData.provider = nums;
            populateNumericTable('providerDataTableBody', nums);
            const sorted = [...nums].sort((a, b) => a - b);
            const mean = nums.reduce((a, b) => a + b, 0) / nums.length;
            const stdDev = Math.sqrt(nums.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) / (nums.length - 1));
            const getQuantile = (d, q) => {
                const pos = (d.length - 1) * q, base = Math.floor(pos), rest = pos - base;
                return d[base+1] !== undefined ? d[base] + rest * (d[base+1] - d[base]) : d[base];
            };
            const median = getQuantile(sorted, 0.50);
            const iqr = getQuantile(sorted, 0.75) - getQuantile(sorted, 0.25);
            document.getElementById('descriptiveResults').innerHTML = `<div class="p-2 bg-gray-50 rounded-lg"><p class="text-sm">Media</p><p class="text-xl font-bold">${mean.toFixed(2)}</p></div> <div class="p-2 bg-gray-50 rounded-lg"><p class="text-sm">Mediana</p><p class="text-xl font-bold">${median.toFixed(2)}</p></div> <div class="p-2 bg-gray-50 rounded-lg"><p class="text-sm">Desv. Estándar</p><p class="text-xl font-bold">${stdDev.toFixed(2)}</p></div> <div class="p-2 bg-gray-50 rounded-lg"><p class="text-sm">IQR</p><p class="text-xl font-bold">${iqr.toFixed(2)}</p></div>`;
            if (boxPlotChart) boxPlotChart.destroy();
            boxPlotChart = new Chart('boxPlotCanvas', { type: 'boxplot', data: { labels: ['Tiempos de Entrega'], datasets: [{ data: [nums], backgroundColor: 'rgba(20, 184, 166, 0.5)', borderColor: 'rgb(15, 118, 110)' }] }, options: { responsive: true, maintainAspectRatio: false, legend: { display: false } } });
        }
        
        function populateNumericTable(tbodyId, data) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';
            data.forEach((value, i) => { tbody.innerHTML += `<tr><td>${i+1}</td><td><input type="number" step="0.1" value="${value}" class="data-input"></td></tr>`; });
        }
        
        // --- Carga Inicial y Configuración de Eventos ---
        window.loadSampleData = function(type) {
            const configs = {
                churn: { findingsBox: 'findings-box-4', chartContainer: 'chartsContainer', tableContainer: 'churnDataTableContainer', toggleButton: 'toggle-churn-data', action: generateQualitativeCharts, dataSource: "Precio elevado,Precio elevado,Mala UX,Falta de funciones,Precio elevado,Competencia mejor,Mala UX,No lo uso,Precio elevado,Falta de funciones,Precio elevado,Mala UX,Competencia mejor,Precio elevado,Precio elevado,Mala UX,No lo uso,Precio elevado" },
                exam_normal: { findingsBox: 'findings-box-5', chartContainer: 'histogramContainer', tableContainer: 'histogramDataTableContainer', toggleButton: 'toggle-histogram-data', action: generateHistogram, dataSource: generateNormalData, explanationTarget: 'histogram-explanation', controls: 'histogramControls' },
                exam_skewed: { findingsBox: 'findings-box-5', chartContainer: 'histogramContainer', tableContainer: 'histogramDataTableContainer', toggleButton: 'toggle-histogram-data', action: generateHistogram, dataSource: generateSkewedData, explanationTarget: 'histogram-explanation', controls: 'histogramControls' },
                tickets: { findingsBox: 'findings-box-6', chartContainer: 'tendencyResults', tableContainer: 'ticketsDataTableContainer', toggleButton: 'toggle-tickets-data', action: calculateCentralTendency, dataSource: "15,22,18,30,12,25,19,28,35,11,24,480,20,16,33" },
                provider_a: { findingsBox: 'findings-box-7', chartContainer: 'dispersionResults', tableContainer: 'providerDataTableContainer', toggleButton: 'toggle-provider-data', action: generateDispersionAnalysis, dataSource: "3.1,2.9,3.0,3.2,2.8,3.1,3.3,2.9,3.0,2.7,3.1,3.0", explanationTarget: 'descriptive-explanation' },
                provider_b: { findingsBox: 'findings-box-7', chartContainer: 'dispersionResults', tableContainer: 'providerDataTableContainer', toggleButton: 'toggle-provider-data', action: generateDispersionAnalysis, dataSource: "1.5,4.5,5.1,2.1,3.0,1.1,2.5,5.5,4.8,0.9,3.5", explanationTarget: 'descriptive-explanation' }
            };

            const config = configs[type];
            if (!config) return;
            
            Object.values(configs).forEach(c => {
                if(document.getElementById(c.tableContainer)) document.getElementById(c.tableContainer).style.display = 'none';
                if(document.getElementById(c.toggleButton)) document.getElementById(c.toggleButton).style.display = 'none';
                if(document.getElementById(c.controls)) document.getElementById(c.controls).style.display = 'none';
                const chartContainer = document.getElementById(c.chartContainer);
                if(chartContainer) chartContainer.style.display = 'grid'; 
            });

            const chartContainer = document.getElementById(config.chartContainer);
            if(chartContainer) chartContainer.style.display = 'grid';
            if(config.controls) document.getElementById(config.controls).style.display = 'flex';
            setupToggle(config.toggleButton, config.chartContainer, config.tableContainer);

            if (config.findingsBox) document.getElementById(config.findingsBox).style.display = 'none';

            const data = typeof config.dataSource === 'function' ? config.dataSource() : config.dataSource;
            config.action(data, parseInt(document.getElementById('binsSlider')?.value || '15', 10));

            const findingsBox = document.getElementById(config.findingsBox);
            if (findingsBox) {
                 const staticExplanations = {
                    provider_a: "El Proveedor A tiene una <strong>Desviación Estándar baja</strong>. Su diagrama de caja es corto y compacto. <br><strong>Decisión:</strong> Es la opción ideal si la <strong>previsibilidad y consistencia</strong> son la máxima prioridad.",
                    provider_b: "El Proveedor B tiene una <strong>Desviación Estándar alta</strong> y su diagrama de caja es muy largo, indicando gran variabilidad. <br><strong>Decisión:</strong> Es una opción <strong>riesgosa</strong> por su inconsistencia.",
                    exam_normal: "La distribución tiene una forma de campana casi simétrica (distribución normal), lo que sugiere que la dificultad del examen fue adecuada. La decisión es mantener el examen sin cambios mayores.",
                    exam_skewed: "La distribución está <strong>sesgada a la izquierda</strong> (la mayoría de las notas son altas). Esto sugiere que el examen pudo haber sido demasiado fácil. La decisión es revisar y ajustar la dificultad del examen."
                };
                if (config.explanationTarget && staticExplanations[type]) {
                    document.getElementById(config.explanationTarget).innerHTML = staticExplanations[type];
                }
                findingsBox.style.display = 'block';
            }
        }
        
        const generatePopulationBtn = document.getElementById('generatePopulationBtn');
        if (generatePopulationBtn) {
            let populationData = [];
            let visualDots = [];
            const dotsContainer = document.getElementById('populationDotsContainer');
            
            function updateMeansHistogram() {
                if (meansHistogramChart) meansHistogramChart.destroy();
                
                const dataMin = Math.min(...sampleMeansDistribution, truePopulationMean);
                const dataMax = Math.max(...sampleMeansDistribution, truePopulationMean);
                const numBins = 15;
                const binWidth = (dataMax - dataMin) / numBins || 1;

                let bins = Array(numBins).fill(0);
                let labels = Array.from({length: numBins}, (_, i) => (dataMin + i * binWidth).toFixed(1));

                sampleMeansDistribution.forEach(mean => {
                    let binIndex = Math.floor((mean - dataMin) / binWidth);
                    if (mean === dataMax) binIndex = numBins - 1;
                    if (binIndex >= 0 && binIndex < numBins) bins[binIndex]++;
                });

                const meanOfMeans = sampleMeansDistribution.length > 0 ? sampleMeansDistribution.reduce((a, b) => a + b, 0) / sampleMeansDistribution.length : 0;
                
                meansHistogramChart = new Chart('meansHistogramCanvas', {
                    type: 'bar',
                    data: { labels, datasets: [{ data: bins, backgroundColor: 'rgba(59, 130, 246, 0.6)' }] },
                    options: { 
                        responsive: true, maintainAspectRatio: false, legend: { display: false },
                        annotation: {
                            annotations: [
                                { type: 'line', mode: 'vertical', scaleID: 'x-axis-0', value: truePopulationMean, borderColor: '#ef4444', borderWidth: 2, label: { enabled: true, content: 'μ', position: 'top' } },
                                { type: 'line', mode: 'vertical', scaleID: 'x-axis-0', value: meanOfMeans, borderColor: '#3b82f6', borderWidth: 2, borderDash: [6, 6], label: { enabled: true, content: 'x̄', position: 'top', yAdjust: -15, font: { style: 'italic' } } }
                            ]
                        },
                        scales: { yAxes: [{ ticks: { beginAtZero: true } }], xAxes: [{ barPercentage: 1.0, categoryPercentage: 1.0, gridLines: { display: false }, ticks: {maxTicksLimit: 10, autoSkip: true} }] } 
                    }
                });
            }

            generatePopulationBtn.addEventListener('click', () => {
                populationData = Array.from({ length: 1000000 }, () => 15 + Math.random() * 250);
                truePopulationMean = populationData.reduce((a, b) => a + b, 0) / populationData.length;
                sampleMeansDistribution = [];
                
                dotsContainer.innerHTML = '';
                visualDots = [];
                for (let i = 0; i < 300; i++) {
                    const dot = document.createElement('span'); dot.className = 'dot';
                    dotsContainer.appendChild(dot); visualDots.push(dot);
                }
                
                document.getElementById('populationMean').textContent = `Promedio Real de Población (μ): $${truePopulationMean.toFixed(2)}`;
                document.getElementById('populationViz').style.display = 'block';
                document.getElementById('drawSampleBtn').disabled = false;
                document.getElementById('sampleViz').style.display = 'none';
                document.getElementById('decision-box-2').style.display = 'none';
                document.getElementById('meansHistogramContainer').style.display = 'none';
                if(meansHistogramChart) meansHistogramChart.destroy();
            });

            document.getElementById('drawSampleBtn').addEventListener('click', () => {
                visualDots.forEach(d => d.classList.remove('sample-dot'));
                let sampleDataArr = Array.from({ length: 1000 }, () => populationData[Math.floor(Math.random() * populationData.length)]);
                const sampleMean = sampleDataArr.reduce((a, b) => a + b, 0) / sampleDataArr.length;
                sampleMeansDistribution.push(sampleMean);

                for (let i = 0; i < 30; i++) {
                    const availableDots = visualDots.filter(d => !d.classList.contains('sample-dot'));
                    if (availableDots.length > 0) availableDots[Math.floor(Math.random() * availableDots.length)].classList.add('sample-dot');
                }

                document.getElementById('sampleMean').textContent = `Promedio de la Muestra Actual: $${sampleMean.toFixed(2)}`;
                document.getElementById('sampleViz').style.display = 'block';
                document.getElementById('samplingConclusion').innerHTML = `El valor promedio de la muestra ($${sampleMean.toFixed(2)}) es un buen estimador del valor real ($${truePopulationMean.toFixed(2)}). <br><strong>Decisión:</strong> Cuantas más muestras tomes, más se acercará su distribución al valor real.`;
                document.getElementById('decision-box-2').style.display = 'block';
                document.getElementById('meansHistogramContainer').style.display = 'block';
                updateMeansHistogram();
            });
            
            document.getElementById('resetMeansBtn').addEventListener('click', () => {
                sampleMeansDistribution = [];
                if(meansHistogramChart) meansHistogramChart.destroy();
                document.getElementById('meansHistogramContainer').style.display = 'none';
            });
        }
        
        const variableToClassify = document.getElementById('variableToClassify');
        if (variableToClassify) {
            const variableOptions = document.getElementById('variableOptions');
            const variableFeedback = document.getElementById('variableFeedback');
            const variables = [ { name: "Motivo de Churn", type: "Cualitativa" }, { name: "Nivel de Satisfacción", type: "Cualitativa" }, { name: "Número de compras", type: "Cuantitativa" }, { name: "Gasto total ($)", type: "Cuantitativa" } ];
            let currentVariable = 0;
            function loadVariable() {
                variableToClassify.textContent = `"${variables[currentVariable].name}"`;
                variableOptions.innerHTML = '';
                ["Cualitativa", "Cuantitativa"].forEach(vtype => {
                    const button = Object.assign(document.createElement('button'), { className: "bg-indigo-100 text-indigo-800 font-semibold py-2 px-4 rounded-lg hover:bg-indigo-200 transition", textContent: vtype, onclick: () => checkVariableAnswer(vtype) });
                    variableOptions.appendChild(button);
                });
                variableFeedback.textContent = '';
            }
            function checkVariableAnswer(selectedType) {
                if (selectedType === variables[currentVariable].type) {
                    variableFeedback.textContent = "¡Correcto!"; variableFeedback.className = "mt-4 text-center font-bold h-6 text-green-600";
                    currentVariable = (currentVariable + 1) % variables.length;
                    setTimeout(loadVariable, 1500);
                } else {
                    variableFeedback.textContent = "Incorrecto, prueba de nuevo."; variableFeedback.className = "mt-4 text-center font-bold h-6 text-red-600";
                }
            }
            loadVariable();
        }

        const binsSlider = document.getElementById('binsSlider');
        if(binsSlider) {
            binsSlider.addEventListener('input', (e) => {
                const numBins = parseInt(e.target.value, 10);
                document.getElementById('binsValue').textContent = numBins;
                if (globalData.histogram) {
                    generateHistogram(globalData.histogram, numBins);
                }
            });
        }
        
        const samplingMethodsPopulation = document.getElementById('samplingMethodsPopulation');
        if (samplingMethodsPopulation) {
             function createSamplingPopulation() {
                samplingMethodsPopulation.innerHTML = '';
                for (let i = 0; i < 100; i++) {
                    const dot = Object.assign(document.createElement('span'), { className: 'dot' });
                    let group = (i < 50) ? 'stratified-1' : (i < 80) ? 'stratified-2' : 'stratified-3';
                    dot.classList.add(group); 
                    samplingMethodsPopulation.appendChild(dot);
                }
            }
            window.runSampling = function(type) {
                createSamplingPopulation();
                setTimeout(() => {
                    if(type === 'simple') {
                        document.getElementById('samplingMethodDesc').textContent = "Aleatorio Simple: Cada individuo tuvo la misma probabilidad.";
                        const allDots = Array.from(samplingMethodsPopulation.querySelectorAll('.dot'));
                        for(let i = 0; i < 20; i++) { if(allDots.length > 0) allDots.splice(Math.floor(Math.random() * allDots.length), 1)[0].classList.add('sample-dot'); }
                    } else if (type === 'stratified') {
                         document.getElementById('samplingMethodDesc').innerHTML = "Estratificado: Se muestrea de cada subgrupo para asegurar representación.";
                         const strata = {'stratified-1': 10, 'stratified-2': 6, 'stratified-3': 4};
                         Object.keys(strata).forEach(group => {
                             let groupMembers = Array.from(samplingMethodsPopulation.querySelectorAll(`.${group}`));
                             for(let i = 0; i < strata[group]; i++) { if(groupMembers.length > 0) groupMembers.splice(Math.floor(Math.random() * groupMembers.length), 1)[0].classList.add('sample-dot'); }
                         });
                    } else if(type === 'reset') { document.getElementById('samplingMethodDesc').textContent = ""; }
                }, 100);
            }
            createSamplingPopulation();
        }

        const speechSections = document.querySelectorAll('.speech-section');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const slideId = entry.target.id;
                    speechSections.forEach(section => {
                        if (section.dataset.slideId === slideId) {
                            section.classList.add('active');
                            section.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        } else {
                            section.classList.remove('active');
                        }
                    });
                }
            });
        }, { root: document.querySelector('.slide-container'), threshold: 0.6 });
        document.querySelectorAll('.slide').forEach(slide => { observer.observe(slide); });
    });
</script>
</body>
</html>
